<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>(ARCOS) WepSIM</title>

    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=yes, initial-scale=1, maximum-scale=2.2, minimum-scale=1, width=device-width">

    <script src="external/jquery.min.js"></script>
    <script src="external/jquery-ui.min.js"></script>
    <script>
        $(document).bind("mobileinit", function() {
            $.mobile.defaultPageTransition = "none";
            $.mobile.defaultDialogTransition = "none";
        });
    </script>
    <script src="external/jquery.mobile-1.4.5.min.js"></script>

    <link rel="stylesheet" href="external/jquery.mobile-1.4.5.min.css">
    <style>
    .ui-panel-inner {
        position: absolute;
        top: 1px;
        left: 0;
        right: 0;
        bottom: 0px;
        overflow: scroll;
        -webkit-overflow-scrolling: touch;
    }

    textarea.ui-input-text { 
        height: inherit !important
    }

    .ui-icon-reset:after {
	background-image: url("images/reset.svg");
        background-repeat: no-repeat;
        background-size: 15px 15px;
    }
    </style>

    <link rel="stylesheet" href="external/bootstrap.min.css">
    <link rel="stylesheet" href="external/bootstrap-theme.min.css">
    <link rel="stylesheet" href="external/spectrum.min.css">

    <script src="external/bootstrap.min.js"></script>
    <script src="external/bootbox.min.js"></script>
    <script src="external/knockout-3.4.0.js"></script>
    <script src='external/tinymce.min.js'></script>
    <script src="external/spectrum.min.js"></script>

    <script src="sim_all.min.js"></script>

    <script>
    //
    // Assembly
    //

    function compileAssembly() 
    {
        // get Assembly
      //var textToConvert = document.getElementById("inputAssembly").value;
        var textToConvert = tinymce.get('inputAssembly').getBody().textContent ;
            textToConvert = textToConvert.toLowerCase();

        // get SIMWARE.firmware
        var SIMWARE = get_simware() ;
	if (SIMWARE.firmware.length == 0) {
            alert('WARNING: please load firmware first.');
            $.mobile.pageContainer.pagecontainer('change','#main3');
            return;
	} 

        // compile Assembly, update memory and segments
        var SIMWAREaddon = simlang_compile(textToConvert, SIMWARE);
        if (SIMWAREaddon.error != null) {
            alert(SIMWAREaddon.error);
            return ;
        }

        set_simware(SIMWAREaddon) ;
	update_memories(SIMWARE);

        // update UI 
        if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
        {
           $("#compile_mp").html("<center><a onclick='showCompiledAssembly();'>" + 
                                 "<br>Assembly was compiled. " + 
                                 "<br>Click here in order to show the main memory in binary." + 
                                 "<br>Warning: it could be slow on a mobile device...</a></center>");
           $("#compile_mp").css({width:"100%",height:"inherit !important"});
        }
        else
        {
             showCompiledAssembly();
        }

        $("#asm_debugger").html(assembly2html(SIMWAREaddon.mp, 
                                              SIMWAREaddon.labels2, 
                                              SIMWAREaddon.seg, 
                                              SIMWAREaddon.assembly));

        $('#btn42').trigger('click');
	reset();
    }

    function showCompiledAssembly () 
    {
        var SIMWARE = get_simware() ;

        $("#compile_mp").html(mp2html(SIMWARE.mp, SIMWARE.labels2, SIMWARE.seg));
        for (skey in SIMWARE.seg) {
             $("#compile_begin_" + skey).html("0x" + SIMWARE.seg[skey].begin.toString(16));
             $("#compile_end_"   + skey).html("0x" + SIMWARE.seg[skey].end.toString(16));
        }
    }

    function load_assembly_from_file() 
    {
        var fileToLoad = document.getElementById("fileToLoad2").files[0];
        var fileReader = new FileReader();
        fileReader.onload  = function (fileLoadedEvent) {
                                            var textFromFileLoaded = fileLoadedEvent.target.result;
					    tinymce.get('inputAssembly').getBody().innerHTML = "<pre>" + textFromFileLoaded + "</pre>";
                             };
	fileReader.onerror = function(e) {
			        console.error("File could not be read! Code " + e.target.error.code);
			     };
        fileReader.readAsText(fileToLoad, "UTF-8");
    }

    function load_assembly_from_example ( )
    {
	var xmlhttp = new XMLHttpRequest();
	var url = "examples/exampleCode2.txt?time=20160104" ;

	xmlhttp.onreadystatechange=function() {
					// if (xmlhttp.readyState == 4 && xmlhttp.status == 200) 
					if ((xmlhttp.readyState == 4) && ((xmlhttp.status == 200) || (xmlhttp.status == 0)))
					{
                                            var textFromFileLoaded = xmlhttp.responseText ;
					    tinymce.get('inputAssembly').getBody().innerHTML = "<pre>" + textFromFileLoaded + "</pre>";
					}
				   }
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
    }


    //
    // Firmware
    //

    function compileFirmware () 
    {
      //var textFromFileLoaded = document.getElementById("inputFirmware").value ;
        var textFromFileLoaded = tinymce.get('inputFirmware').getBody().textContent ;

	var preSM = load_firmware(textFromFileLoaded) ;
	if (preSM.error != null) {
            alert(preSM.error);
            return ;
        }

        // update UI 
        if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
        {
           $("#ucompile").html("<center><a onclick='showCompiledFirmware();'>" +
                               "<br>Firware was compiled. " +
                               "<br>Click here in order to show the control memory in binary." +
                               "<br>Warning: it could be slow on a mobile device...</a></center>");
           $("#ucompile").css({width:"100%",height:"inherit !important"});
        }
        else
        {
             showCompiledFirmware();
        }

	$('#btn32').trigger('click');
	reset() ;
    }

    function showCompiledFirmware () 
    {
        var SIMWARE = get_simware() ;
        $("#ucompile").html(firmware2html(SIMWARE.firmware, true));
	$("#ucompile").css({width:"100%",height:"inherit !important"});
    }

    function load_firmware_from_file ( )
    {
        var fileToLoad = document.getElementById("fileToLoad").files[0];
        var fileReader = new FileReader();
        fileReader.onload = function (fileLoadedEvent) {
                                            var textFromFileLoaded = fileLoadedEvent.target.result;
					    tinymce.get('inputFirmware').getBody().innerHTML = "<pre>" + textFromFileLoaded + "</pre>";
                                };
	fileReader.onerror = function(e) {
			        console.error("File could not be read! Code " + e.target.error.code);
			     };
        fileReader.readAsText(fileToLoad, "UTF-8");
    }

    function load_firmware_from_example ( )
    {
	var xmlhttp = new XMLHttpRequest();
	var url = "examples/exampleFirmware5.txt?time=20160104" ;

	xmlhttp.onreadystatechange=function() {
					// if (xmlhttp.readyState == 4 && xmlhttp.status == 200) 
					if ((xmlhttp.readyState == 4) && ((xmlhttp.status == 200) || (xmlhttp.status == 0)))
					{
                                            var textFromFileLoaded = xmlhttp.responseText ;
					    tinymce.get('inputFirmware').getBody().innerHTML = "<pre>" + textFromFileLoaded + "</pre>";
					}
				   }
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
    }


    //
    // UI
    //

    function save_as_file ( contentInputName, filenameInputName )
    {
          //var textToWrite = document.getElementById(contentInputName).value;
            var textToWrite = tinymce.get(contentInputName).getBody().textContent ;
            var textFileAsBlob = new Blob([textToWrite], { type: 'text/plain' });
            var fileNameToSaveAs = document.getElementById(filenameInputName).value;

            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            if (window.webkitURL != null) {
                // Chrome allows the link to be clicked
                // without actually adding it to the DOM.
                downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
            }
            else {
                // Firefox requires the link to be added to the DOM
                // before it can be clicked.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.onclick = function ( event ) {
                                            document.body.removeChild(event.target);
                                       };
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
            }

            downloadLink.click();
    }

    function toggle_play ( btn1 )
    {
        if (DBG_stop == false) {
            DBG_stop = true ;
        } else {
            DBG_stop = false ;
            asmdbg_play(btn1) ;
        }
    }

    function sim_init ( )
    {
	    var ref_p = document.getElementById('svg_p').contentDocument ;
	    if (ref_p != null)
            {
                var o  = ref_p.getElementById('text3495');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab11').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3029');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab11').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3031');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab11').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3001');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab14').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3183');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab23').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3775');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab15').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3829');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab12').trigger('click');
                                                  }, false);
	        var o  = ref_p.getElementById('text3845');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab12').trigger('click');
                                                  }, false);
                var o  = ref_p.getElementById('text3459-7');
                if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     execute_microinstruction(); 
                                                  }, false);
            }

	    var ref_cu = document.getElementById('svg_cu').contentDocument ;
	    if (ref_cu != null)
            {
	        var o  = ref_cu.getElementById('text3010');
	        if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab16').trigger('click');
                                                  }, false);
                var o  = ref_cu.getElementById('text3346-5');
                if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     $('#tab22').trigger('click');
                                                  }, false);
                var o  = ref_cu.getElementById('text4138');
                if (o != null) o.addEventListener('click', 
                                                  function() { 
                                                     execute_microinstruction(); 
                                                  }, false);
            }
    }
    </script>

</head>


<body>


<div data-role="page" id="main1">

	<div data-role="header" data-position="fixed" data-disable-page-zoom="false" data-theme="a">
                <div id="button_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-left">
                    <a href="#about1" data-rel="popup" data-position-to="window"><img src="images/arcos.svg" height="40"></a>
                </div>
                <span class="ui-title"><b>WepSIM</b> <span class="badge">1.2.1</span> </span>
		<div id="action_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-right">
                    <a href="#actions_panel" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b">Menu</a>
		</div>
	</div><!-- /header -->

	<div role="main" class="ui-content">

            <div class="row">
                <div class="col-md-8" style="padding: 0 2px 0 2px;">
		    <div data-role="tabs" id="tabs2">
    		      <div data-role="navbar" id="tabsnav2" class="ui-responsive">
		        <ul>
		          <li style="clear:none;width:33% !important">
                              <a id="tab23" href="#eltos_cu"   
                                 onclick="start_drawing(); refresh();">Control Unit</a>
                          </li>
		          <li style="clear:none;width:27% !important">
                              <a id="tab22" href="#eltos_p"   class="ui-btn-active"
                                 onclick="start_drawing(); refresh();">CPU</a>
                          </li>
		          <li style="clear:none;width:40% !important">
                              <a id="tab24" href="#eltos_dbg"  
                                 onclick="stop_drawing();">Assembly Debugger</a>
                          </li>
		        </ul>
		      </div>
		      <div id="eltos_p"  class="ui-body-d ui-content" style="padding: 15px 0 15px 0;">
			    <object id="svg_p" data="images/imagenProcesador2.svg" type="image/svg+xml">
				Your browser doesn't support SVG
			    </object>
                            <img id=busfire src="images/fire.gif" height=50 style="position:absolute; top:55%; left:8%; display:none;">
		      </div>
		      <div id="eltos_cu"  class="ui-body-d ui-content">
			    <object id="svg_cu" data="images/imagenUnidadControl2.svg" type="image/svg+xml">
				Your browser doesn't support SVG
			    </object>
		      </div>
		      <div id="eltos_dbg"  class="ui-body-d ui-content">
			   <center>
		   	   <table class='table ui-responsive ui-table' style="margin-bottom: 0px;">
		   	   <thead>
			   <tr>
			   <th width=10%>break<span class="hidden-xs">points</span></th>
			   <th width=15%>address</th>
                           <th width=12%>&nbsp;</th>
                           <th width=25%>assembly</th>
                           <th width=12% class='hidden-xs'>&nbsp;</th>
                           <th width=25% class='hidden-xs'>pseudo-instructions</th>
			   </tr>
			   </thead>
			   </table>
			   </center>

		           <div style="overflow-y:auto; overflow-x:auto; height:70% !important;">
                                <div id="asm_debugger">
                                <br>
                                <ol>
                                <li>Load the firmware to be used.</li>
                                    <ul>
                                    <li>You can use the default firmware example, load it from a file or you can edit one.</li>
                                    </ul>
                                <br>
                                <li>Load the assembly to be used.</li>
                                    <ul>
                                    <li>You can use the default assembly example, load it from a file or you can edit one.</li>
                                    </ul>
                                <br>
                                <li>Come back to the simulator in order to execute step by step the firmware+assembly loaded before.</li>
                                    <ul>
                                    <li>Each step could be executed at microinstruction or instruction level.</li>
                                    </ul>
                                </ol>
                                </div>
		           </div>
		      </div>
	    	    </div>
                </div>

                <div class="col-md-4" style="padding: 0 12px 0 12px;">

                    <div class="btn-toolbar" role="toolbar" id="sim_toolbar" style="padding: 0 0px 10px 0px;">
			<div class="btn-group btn-group-justified" role="group">
			    <a          href="#" style="background-color: #CCCCCC"
			       class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-reset   ui-btn-icon-top ui-mini"
			       onclick="reset();">Reset</a>
			    <a          href="#" style="background-color: #CCCCCC"
			       class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-arrow-r ui-btn-icon-top ui-mini"
			       onclick="execute_microinstruction();">&#181;Instruction</a>
			    <a          href="#" style="background-color: #CCCCCC"
			       class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-arrow-r ui-btn-icon-top ui-mini"
			       onclick="execute_instruction();">Instruction</a>
			    <a id="qbp" href="#" style="background-color: #CCCCCC"
			       class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-carat-r ui-btn-icon-top ui-mini"
			       onclick="toggle_play('#qbp'); return false;">Run</a>
			    <a id="ib1" href="#" style="background-color: #D4DB17; -webkit-text-shadow: none; text-shadow: none;"
			       class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-info ui-btn-icon-top ui-mini"
			       onclick="$('#iframe_help1').load('sim_help.html #help_simulator_screens', 
                                                                function(){$('#help1').trigger('updatelayout');
					                        $('#help1').popup('open');});">Help</a>
                        </div>
                    </div>

		    <div data-role="tabs" id="tabs1">
    		      <div data-role="navbar" id="tabsnav1" class="ui-responsive">
		        <ul>
		          <li style="clear:none;width:33% !important"><a id="tab14" href="#mp" class="ui-btn-active">Memory</a></li>
		          <li style="clear:none;width:33% !important"><a id="tab15" href="#io">I/O</a></li>
		          <li style="clear:none;width:33% !important"><a id="tab12" href="#con">Console</a></li>
                          <br>
		          <li style="           width:33% !important"><a id="tab11" href="#all">Registers</a></li>
		          <li style="clear:none;width:33% !important"><a id="tab16" href="#mc">Control Memory</a></li>
		          <li style="clear:none;width:33% !important"><a id="tab13" href="#stats">Statistics</a></li>
		        </ul>
		      </div>
		      <div id="all"  class="ui-body-d ui-content" style="padding: 15 0px 0 0px;">
		         <div id="states_ALL"          style="width: inherit; overflow-y: auto;"></div>
			 <br style="height:0; width:100%; font-size:0; margin:5; padding:0; border:0; display:block;">
		         <div id="states_BR"           style="width: inherit; overflow-y: auto;"></div>
		      </div>
	    	      <div id="stats"  class="ui-body-d ui-content">
			 <div class="panel panel-default">
			      <div class="panel-body">
		              <div id="stats_ALL"           style="width: inherit; overflow-y: auto;"></div>
			      </div>
			 </div>
		      </div>
		      <div id="mp"   class="ui-body-d ui-content">
		         <div id="memory_MP"           style="height:60vh; width: inherit; overflow-y: scroll;"></div>
		      </div>
		      <div id="mc"   class="ui-body-d ui-content">
		         <div id="memory_MC"           style="height:60vh; width: inherit; overflow-y: scroll;"></div>
		      </div>
		      <div id="con"  class="ui-body-d ui-content">
                         <img height=55 src="images/monitor2.png">
		         <textarea style="min-width:90%; overflow-y:auto;" placeholder="ARCOS" id="kdb_con" rows=10></textarea>
                         <img height=35 src="images/keyboard1.png">
		         <textarea style="min-width:90%; overflow-y:auto;" placeholder="ARCOS" id="kdb_key" rows=2></textarea>
		      </div>
		      <div id="io"  class="ui-body-d ui-content">
		         <div id="io_ALL"              style="width: inherit; overflow-y: auto;"></div>
		      </div>
	    	    </div>
                </div>
            </div>

	</div><!-- /content -->

</div><!-- /page -->


<div data-role="page" id="main3">

	<div data-role="header" data-position="fixed" data-disable-page-zoom="false" data-theme="a">
                <div id="button_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-left">
                    <a href="#about1" data-rel="popup" data-position-to="window"><img src="images/arcos.svg" height="40"></a>
                </div>
                <span class="ui-title"><b>WepSIM</b> <span class="badge">1.2.1</span> </span>
		<div id="action_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-right">
                    <a href="#actions_panel" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b">Menu</a>
		</div>
	</div><!-- /header -->

	<div role="main" class="ui-content">

		<div id="lsload" 
                     data-role="popup" data-overlay-theme="a" data-theme="a" data-dismissible="false">
		    <div data-role="header" data-theme="a">
		    <h1>Firmware</h1>
		    </div>
		    <div role="main" class="ui-content">
			<h3>Please select the file to be loaded:</h3>
			<p><input type="file" id="fileToLoad" /></p>
			<center>
			<a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
                        <button class="ui-btn ui-btn-b ui-btn-inline" 
                                onclick="load_firmware_from_file();
                                         $('#lsload').popup('close');">Load from File</button>
                        </center>
		    </div>
		</div>

		<div id="lssave" 
                     data-role="popup" data-overlay-theme="a" data-theme="a" data-dismissible="false">
		    <div data-role="header" data-theme="a">
		    <h1>Save Page</h1>
		    </div>
		    <div role="main" class="ui-content">
			<h2>Please write the file name where firmware will be saved:</h2>
			<p><input id="inputFileNameToSaveAs" style="min-width: 90%;"/></p>
			<center>
			<a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
                        <button class="ui-btn ui-btn-b ui-btn-inline" 
                                onclick="var SIMWARE = get_simware() ;
                                         var simware_as_text = saveFirmware(SIMWARE);
                                         if (simware_as_text.trim() == '') {
					     alert('The firmware loaded in memory is empty!\n' + 
                                                   'Please load a firmware first in memory in order to save it.');
					 }
					 else {
                                           //document.getElementById('inputFirmware').value = simware_as_text ;
					     tinymce.get('inputFirmware').getBody().innerHTML = '<pre>' + simware_as_text + '</pre>' ;
                                             save_as_file('inputFirmware', 'inputFileNameToSaveAs');
					 }">Save to File</button>
                        </center>
		    </div>
		</div>

                <ul class="nav nav-justified">
                <li><ul class="nav nav-justified col-md-5">
		            <li><a href="#lssave" style="background-color: #CCCCCC"
				   class="ui-btn navbar-btn ui-corner-all ui-btn-inline ui-btn-a ui-icon-forward ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-rel="popup" data-position-to="window" data-transition="pop">Save</a></li>
		            <li><a href="#lsload" style="background-color: #CCCCCC"
				   class="ui-btn navbar-btn ui-corner-all ui-btn-inline ui-btn-a ui-icon-back    ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-rel="popup" data-position-to="window" data-transition="pop">Load</a></li>
		            <li><a href="#"       style="background-color: #CCCCCC" 
				   onclick="load_firmware_from_example(); $('#btn31').trigger('click');"
				   class="ui-btn navbar-btn ui-corner-all ui-btn-inline ui-btn-a ui-icon-bars    ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12">Example</a></li>
		            <li><a href="#"       style="background-color: #CCCCCC" 
				   onclick="compileFirmware();"
				   class="ui-btn navbar-btn ui-corner-all ui-btn-inline ui-btn-a ui-icon-refresh ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12">&#181;compile</a></li>
		</ul></li>
                <li><ul class="nav nav-justified col-md-2">
			    <li><a id="tab24" href="#" style="background-color: #CCCCCC"
				   class="ui-btn navbar-btn ui-corner-all ui-btn-inline ui-btn-a ui-icon-arrow-r ui-btn-icon-left  ui-mini col-xs-5 col-sm-12 col-md-12"
				   onclick="$.mobile.pageContainer.pagecontainer('change','#main4');">Assembly</a></li>
                            <li><a id="tab25" href="#" style="background-color: #D4DB17"
                                   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-info     ui-btn-icon-left  ui-mini col-xs-5 col-sm-12 col-md-12"
				   onclick="$('#iframe_help1').load('sim_help.html #help_firmware_format',  function(){$('#help1').trigger('updatelayout');
					    $('#help1').popup('open');});">Help</a></li>
		</ul></li>
                <li><ul class="nav nav-justified col-md-5">
		            <li><a id=btn31 href="#" 
				   class="ui-btn navbar-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-a ui-btn-active   ui-mini col-xs-12 col-sm-12 col-md-12"
				   onclick="$('#tab31').trigger('click'); $('#btn32').removeClass('ui-btn-active'); $('#btn31').addClass('ui-btn-active');"
				   >Firmware Specification</a></li>
		            <li><a id=btn32 href="#"  
				   class="ui-btn navbar-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-a                 ui-mini col-xs-12 col-sm-12 col-md-12"
				   onclick="$('#tab32').trigger('click'); $('#btn31').removeClass('ui-btn-active'); $('#btn32').addClass('ui-btn-active');"
				   >co2&#181;addr + control memory</a></li>
		</ul></li>
		</ul>

		<div data-role="tabs" id="tabs3">
		      <div data-role="navbar" style="visibility:hidden; position:absolute;">
		        <ul>
		          <li><a id=tab31 href="#t3_firm" data-ajax="false">Firmware</a></li>
		          <li><a id=tab32 href="#t3_bin"  data-ajax="false">Binary</a></li>
		        </ul>
		      </div>

		      <div id="t3_firm"  class="ui-body-d ui-content" style="position:relative;">
		        <textarea style="min-width:90%; overflow-y:auto;"
                                  placeholder="Please select 'Example' or 'Load' first in order to have an initial firmware."
                                  id="inputFirmware" rows=20></textarea>
		      </div>

		      <div id="t3_bin"   class="ui-body-d ui-content" style="overflow-y:scroll; overflow-x:scroll; height:75%; position:relative;">
		        <div id="ucompile">
                            <br>
                            <center>
                            Please load the firmware specification and then &#181;compile it. <br>
                            In this way the binary will be created and loaded into control memory.
                            </center>
                        </div>
		      </div>
		</div>

	</div><!-- /content -->

</div><!-- /page -->


<div data-role="page" id="main4">

	<div data-role="header" data-position="fixed" data-disable-page-zoom="false" data-theme="a">
                <div id="button_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-left">
                    <a href="#about1" data-rel="popup" data-position-to="window"><img src="images/arcos.svg" height="40"></a>
                </div>
                <span class="ui-title"><b>WepSIM</b> <span class="badge">1.2.1</span> </span>
		<div id="action_bar" data-role="controlgroup" data-type="horizontal" class="ui-btn-right">
                    <a href="#actions_panel" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b">Menu</a>
		</div>
	</div><!-- /header -->

	<div role="main" class="ui-content">

		<div id="lsload2" 
                     data-role="popup" data-overlay-theme="a" data-theme="a" data-dismissible="false">
		    <div data-role="header" data-theme="a">
		    <h1>Assembler</h1>
		    </div>
		    <div role="main" class="ui-content">
			<h3>Please select the file to be assembled:</h3>
			<p><input type="file" id="fileToLoad2" /></p>
			<center>
			<a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
                        <button class="ui-btn ui-btn-b ui-btn-inline" 
                                onclick="load_assembly_from_file();
                                         $('#lsload2').popup('close');">Load from File</button>
                        </center>
		    </div>
		</div>

		<div id="lssave2" 
                     data-role="popup" data-overlay-theme="a" data-theme="a" data-dismissible="false">
		    <div data-role="header" data-theme="a">
		    <h1>Save Page</h1>
		    </div>
		    <div role="main" class="ui-content">
			<h2>Please write the file name where assembly will be saved:</h2>
			<p><input id="inputFileNameToSaveAs2" style="min-width: 90%;"/></p>
			<center>
			<a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
                        <button class="ui-btn ui-btn-b ui-btn-inline" 
                                onclick="save_as_file('inputAssembly','inputFileNameToSaveAs2');">Save to File</button>
                        </center>
		    </div>
		</div>

                <ul class="nav nav-justified">
                <li><ul class="nav nav-justified col-md-5">
		            <li><a href="#lssave2" style="background-color: #CCCCCC"
				   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-forward  ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-rel="popup" data-position-to="window" data-transition="pop" data-inline="true">Save</a></li>
		            <li><a href="#lsload2" style="background-color: #CCCCCC"
				   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-back     ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-rel="popup" data-position-to="window" data-transition="pop" data-inline="true">Load</a></li>
		            <li><a href="#" style="background-color: #CCCCCC"
                                   onclick="load_assembly_from_example(); $('#btn41').trigger('click');"
				   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-bars     ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-inline="true">Example</a></li>
		            <li><a href="#" style="background-color: #CCCCCC"
                                   onclick="compileAssembly();" id="emp"
				   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-refresh  ui-btn-icon-left ui-mini col-xs-5 col-sm-12 col-md-12"
				   data-inline="true">Compile</a></li>
                </ul></li>
                <li><ul class="nav nav-justified col-md-2">
                            <li><a id="tab25" href="#" style="background-color: #CCCCCC"
                                   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-arrow-r  ui-btn-icon-left  ui-mini col-xs-5 col-sm-12 col-md-12"
                                   onclick="$.mobile.pageContainer.pagecontainer('change','#main1');">Simulator</a></li>
                            <li><a id="tab25" href="#" style="background-color: #D4DB17"
                                   class="ui-btn btn-group ui-corner-all ui-btn-inline ui-btn-a ui-icon-info     ui-btn-icon-left  ui-mini col-xs-5 col-sm-12 col-md-12"
				   onclick="$('#iframe_help1').load('sim_help.html #help_assembly_format',  function(){$('#help1').trigger('updatelayout');
					    $('#help1').popup('open');});">Help</a></li>
                </ul></li>
                <li><ul class="nav nav-justified col-md-5">
		            <li><a id=btn41 href="#" 
				   class="ui-btn btn-group ui-corner-all ui-shadow ui-btn-inline ui-btn-a ui-btn-active ui-mini col-xs-12 col-sm-12 col-md-12"
				   onclick="$('#tab41').trigger('click'); $('#btn42').removeClass('ui-btn-active'); $('#btn41').addClass('ui-btn-active');"
				   >Assembly Code</a></li>
		            <li><a id=btn42 href="#"  
				   class="ui-btn btn-group ui-corner-all ui-shadow ui-btn-inline ui-btn-a               ui-mini col-xs-12 col-sm-12 col-md-12"
				   onclick="$('#tab42').trigger('click'); $('#btn41').removeClass('ui-btn-active'); $('#btn42').addClass('ui-btn-active');"
				   >Main Memory</a></li>
                </ul></li>
		</ul>

		<div data-role="tabs" id="tabs4">
		      <div data-role="navbar" id="tabsnav4" style="visibility:hidden; position:absolute;">
		        <ul>
		          <li style="width:50% !important"><a id="tab41" href="#t4_asm" class="ui-btn-active">Assembly code</a></li>
		          <li style="width:50% !important"><a id="tab42" href="#t4_bin">Compilation result (main memory)</a></li>
		        </ul>
		      </div>
		      <div id="t4_asm"   class="ui-body-d ui-content">
		        <textarea style="min-width:90%; overflow-y:auto;"
                                  placeholder="Please select 'Load' first to have the assembly code to work with."
			          id="inputAssembly" rows="20"></textarea>
		      </div>
		      <div id="t4_bin"   class="ui-body-d ui-content" style="padding: 0 0px 0 0px;">

                        <div class="row">
                        <div class="col-xs-12 col-sm-12">
		        <div id="cc_bin" style="overflow-y:scroll; overflow-x:auto; height:70% !important;">
                           <br>
                           <div id="compile_mp">
                              <br>
                              <center>
                              Please load the assembly and then compile it. <br>
                              In this way the binary will be created and loaded into main memory.
                              </center>
		           </div>
		        </div>
		        </div>
		        </div>

		      </div>
		</div>

	</div><!-- /content -->

</div><!-- /page -->


<div data-role="panel" id="actions_panel" data-display="overlay" data-position="right" data-theme="a" 
     style="width:20em; min-width:17em;">

	<div data-role="collapsible-set">
	    <div data-role="collapsible" data-collapsed="false" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d">
	    <h3>WorkSpaces</h3>
	    <p>
	    <ul id="listview_1" data-role="listview" data-inset="false" data-theme="a" data-divider-theme="b">
		    <li><a id="tab21" href="#" style="background-color: lightgray"
			   onclick="$.mobile.pageContainer.pagecontainer('change','#main3');"><h2>Firmware</h2></a></li>
		    <li><a id="tab24" href="#" style="background-color: lightgray"
			   onclick="$.mobile.pageContainer.pagecontainer('change','#main4');"><h2>Assembly</h2></a></li>
		    <li><a id="tab25" href="#" style="background-color: lightgray"
			   onclick="$.mobile.pageContainer.pagecontainer('change','#main1');"><h2>Simulator</h2></a></li>
	    </ul>
            </p>
	    </div>

	    <div data-role="collapsible" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d">
	    <h3>Help</h3>
	    <p>
	    <ul id="listview_2" data-role="listview" data-inset="false" data-theme="a" data-divider-theme="b" data-mini="true">
		    <li><a href="#" class="ui-btn ui-btn-icon-left ui-icon-info" style="background-color: #D4DB17;"
			   onclick="$('#iframe_help1').load('sim_help.html #help_simulator_screens', function(){$('#help1').trigger('updatelayout');
				    $('#help1').popup('open');});"><h2>Simulator usage</h2></a></li>
		    <li><a href="#" class="ui-btn ui-btn-icon-left ui-icon-info" style="background-color: #D4DB17;"
			   onclick="$('#iframe_help1').load('sim_help.html #help_firmware_format',  function(){$('#help1').trigger('updatelayout');
				    $('#help1').popup('open');});"><h2>Firmware format</h2></a></li>
		    <li><a href="#" class="ui-btn ui-btn-icon-left ui-icon-info" style="background-color: #D4DB17;"
			   onclick="$('#iframe_help1').load('sim_help.html #help_assembly_format',  function(){$('#help1').trigger('updatelayout');
				    $('#help1').popup('open');});"><h2>Assembly format</h2></a></li>
		    <li><a href="#" class="ui-btn ui-btn-icon-left ui-icon-info" style="background-color: #D4DB17;"
			   onclick="$('#iframe_help1').load('sim_help.html #help_simulator_arch',    function(){$('#help1').trigger('updatelayout');
				    $('#help1').popup('open');});"><h2>Simulator architecture</h2></a></li>
	    </ul>
            </p>
	    </div>

	    <div data-role="collapsible" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d">
	    <h3>Configuration</h3>
	    <p>
	    <ul id="listview_3" data-role="listview" data-inset="false" data-theme="a" data-divider-theme="b">
		    <li class="list-group-item">
			 Speed-up (slow - fast):
			 <input type="range"
				data-show-value="false"
				name="slider1" id="slider1"
				min="1" max="100" value="100" step=1
				onchange="DBG_delay = 1000 / this.value;">
			 <fieldset data-role="controlgroup" data-type="horizontal">
			 Single step element:
			 <ul>
			 <li>
			     <input name="radio-choice-h-2" id="radio-choice-h-2a" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="DBG_level='instruction';"
				    value="on" checked="checked" type="radio">
			     <label for="radio-choice-h-2a">Instruc.</label>
			     <input name="radio-choice-h-2" id="radio-choice-h-2b" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="DBG_level='microinstruction';"
				    value="off" type="radio">
			     <label for="radio-choice-h-2b">&#181;instruc.</label>
			 </li>
			 </ul>
			 </fieldset>
		    </li>
		    <li class="list-group-item">
<div class="ui-grid-solo">
<div class="ui-block-a">
			 <fieldset data-role="controlgroup" data-type="horizontal">
			 RF display format:<br>
			 <ul>
			 <li>
			     <input name="radio-choice-h-3" id="radio-choice-h-3a" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="RF_display_format=16; show_rf_values();"
				    value="on" checked="checked" type="radio">
			     <label for="radio-choice-h-3a">Hex.</label>
			     <input name="radio-choice-h-3" id="radio-choice-h-3b" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="RF_display_format=10; show_rf_values();"
				    value="off" type="radio">
			     <label for="radio-choice-h-3b">Dec.</label>
			     <input name="radio-choice-h-3" id="radio-choice-h-3c" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="RF_display_format=8; show_rf_values();"
				    value="off" type="radio">
			     <label for="radio-choice-h-3c">Oct.</label>
			 </li>
			 </ul>
			 </fieldset>
</div>
</div>
<div class="ui-grid-solo">
<div class="ui-block-a">
			 <fieldset data-role="controlgroup" data-type="horizontal">
			 RF name nomenclature:<br>
			 <ul>
			 <li>
			     <input name="radio-choice-h-4" id="radio-choice-h-4a" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="RF_display_name='numerical'; show_rf_names();"
				    value="on" checked="checked" type="radio">
			     <label for="radio-choice-h-4a">Numbers</label>
			     <input name="radio-choice-h-4" id="radio-choice-h-4b" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="RF_display_name='logical'; show_rf_names();"
				    value="off" type="radio">
			     <label for="radio-choice-h-4b">Labels</label>
			 </li>
			 </ul>
			 </fieldset>
</div>
</div>
		    </li>
		    <li class="list-group-item input-toggles">
			 Data-path Color:
			 <ul>
			 <li>
			 <input type="color"
                                id="colorpicker1"
				data-show-value="false"
                                class="noshadow"
				value="#0066FF"
				onchange="color_data_active = $('#colorpicker1').spectrum('get'); refresh();">
			 </li>
			 </ul>
			 Signal Color:
			 <ul>
			 <li>
			 <input type="color"
                                id="colorpicker2"
				data-show-value="false"
                                class="noshadow"
				value="red"
				onchange="color_name_active = $('#colorpicker2').spectrum('get'); refresh();">
			 </li>
			 </ul>
<div class="ui-grid-solo">
<div class="ui-block-a">
			 <fieldset data-role="controlgroup" data-type="horizontal">
			 Interactive Mode:<br>
			 <ul>
			 <li>
			     <input name="radio-choice-h-5" id="radio-choice-h-5a" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="set_interactive_mode(true);"
				    value="on" checked="checked" type="radio">
			     <label for="radio-choice-h-5a">On</label>
			     <input name="radio-choice-h-5" id="radio-choice-h-5b" data-mini="true"
                                    style="margin-top:-8px"
				    onclick="set_interactive_mode(false);"
				    value="off" type="radio">
			     <label for="radio-choice-h-5b">Off</label>
			 </li>
			 </ul>
			 </fieldset>
</div>
</div>
		    </li>
	    </ul>
            </p>
	    </div>
	</div>

</div><!-- /panel -->


<div data-role="popup" id="about1" 
     data-theme="a" data-dismissible="false" data-animate="false" data-overlay-theme="b">

   <div data-role="header" data-theme="a">
   <h1><b>Web elemental processor SIMulator</b> <span class="badge btn-success">1.2.1</span> </h1>
   </div>
   <div role="main" class="ui-content">

        <div style="font-family: Helvetica Neue,Helvetica,Arial,sans-serif; font-size: 16px; line-height: 24px; padding-bottom: 6.4px; padding-left: 8px; padding-right: 8px; padding-top: 6.4px;">
        <div class="row">
        <div class="col-xs-12 col-sm-12">
            Copyright &copy; 2015-2016 <small>Javier Prieto Cepeda, F&eacute;lix Garc&iacute;a Carballeira, and Alejandro Calder&oacute;n Mateos</small>
            <p>
        </div>
        <div class="col-xs-12 col-sm-12" style="max-height:50vh; overflow-y: scroll;">
		<div class="col-xs-12 col-sm-12">
		    <b>WepSIM</b> is free software: you can redistribute it and/or modify
		    it under the terms of the GNU Lesser General Public License as published by
		    the Free Software Foundation, either version 3 of the License, or
		    (at your option) any later version.
		    See <a rel="external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
		    <p>
		</div>
		<div class="col-xs-12 col-sm-12">
		    <b>WepSIM</b> uses different technologies such as
		    <a rel="external" href="https://jquerymobile.com/">Jquery Mobile</a>,
		    <a rel="external" href="http://knockoutjs.com/">Knockout</a>,
		    <a rel="external" href="http://getbootstrap.com/">Bootstrap</a>,
		    <a rel="external" href="http://bootboxjs.com/">Bootbox</a>,
		    <a rel="external" href="https://www.tinymce.com/">tinymce</a> Editor (Community version),
		    and the <a rel="external" href="https://bgrins.github.io/spectrum/">spectrum</a> ColorPicker.
		    <p>
		</div>
		<div class="col-xs-12 col-sm-12">
		    More information: <a rel="external" href="http://www.arcos.inf.uc3m.es/~ec-2ed/">http://www.arcos.inf.uc3m.es/~ec-2ed/</a><br>
		    <p>
		</div>
        </div>
        <div class="col-xs-6 col-sm-6">
            <img height=55 src="images/arcos.svg">
        </div>
        <div class="col-xs-6 col-sm-6">
            <center><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">OK</a></center>
        </div>
        </div>
        </div>

   </div>

</div><!-- /popup -->


<div data-role="popup" id="help1" 
     data-theme="a" data-dismissible="false" data-animate="false" data-overlay-theme="b">

      <div data-role="header" data-theme="b" class="ui-corner-top">
           <h1>Help</h1>
           <a href="#" 
              data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" 
              class="ui-btn-right">Close</a>
      </div>

      <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
              <div class="ui-body-d ui-content"
                   style="padding: 2px 2px 2px 2px;">
                 <div id=iframe_help1 style="height:80vh; width: inherit; overflow-y: auto;"></div>
              </div>
      </div>

</div><!-- /panel -->


<script>
    $(document).ready(function()
    {
            jQuery.fx.off = true;

            $("#about1").enhanceWithin().popup();
            $("#help1").enhanceWithin().popup();

            $("#actions_panel").panel().enhanceWithin();
	    $(".ui-slider-input").hide();
            $("#listview_1").listview();

            $("#tabsnav1").navbar();
            $("#tabsnav2").navbar();
            $("#tabsnav4").navbar();

            $("#tabs1").tabs();
            $("#tabs2").tabs();
            $("#tabs3").tabs();
            $("#tabs4").tabs();

	    $("#sim_toolbar").draggable();
            $("#colorpicker1").spectrum({ preferredFormat: "hex", color: color_data_active}) ;
            $("#colorpicker2").spectrum({ preferredFormat: "hex", color: color_name_active}) ;

            tinymce.init({ 
                          selector: '#inputFirmware',
		          height:   '50%',
			  plugins: [
			    'lists charmap print preview',
			    'searchreplace wordcount fullscreen',
			    'contextmenu paste'
			  ],
                          menubar: 'file edit view',
                          toolbar: 'insertfile undo redo | alignleft aligncenter alignright alignjustify | outdent indent'
                    });
            tinymce.init({ 
                          selector: '#inputAssembly',
		          height:   '50%',
			  plugins: [
			    'lists charmap print preview',
			    'searchreplace wordcount fullscreen',
			    'contextmenu paste'
			  ],
                          menubar: 'file edit view',
                          toolbar: 'insertfile undo redo | alignleft aligncenter alignright alignjustify | outdent indent'
                    });

            var a = document.getElementById("svg_p");
            a.addEventListener("load",function() {
                sim_init();
                init_eventlistener();
                refresh();
            }, false);

            var a = document.getElementById("svg_cu");
            a.addEventListener("load",function() {
                sim_init();
                init_eventlistener();
                refresh();
            }, false);

            $.mobile.pageContainer.pagecontainer('change','#main1');
            $('#tab11').trigger('click');
            $('#tab22').trigger('click');
    }) ;

    init(); 
    reset(); 
</script>

</body>

</html>
