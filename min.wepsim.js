function wepsim_load_from_file(d,a){var c=new FileReader();c.onload=function(e){var f=e.target.result;if(null!=a){a.setValue(f)}};c.onerror=function(f){console.error("File could not be read! Code "+f.target.error.code)};c.readAsText(d,"UTF-8")}function wepsim_save_to_file(c,f){var e=c.getValue();var d=new Blob([e],{type:"text/plain"});var a=document.createElement("a");a.download=f;a.innerHTML="Download File";if(window.webkitURL!=null){a.href=window.webkitURL.createObjectURL(d)}else{a.href=window.URL.createObjectURL(d);a.onclick=function(g){document.body.removeChild(g.target)};a.style.display="none";document.body.appendChild(a)}a.click()}function wepsim_load_from_url(c,a){var d=new XMLHttpRequest();d.onreadystatechange=function(){if((d.readyState==4)&&((d.status==200)||(d.status==0))){var e=d.responseText;if(null!=a){a(e)}}};d.open("GET",c,true);d.send()}function wepsim_compile_assembly(a){return compileAssembly(a,false)}function wepsim_compile_microcode(a){return compileFirmware(a,false)}function wepsim_execute_reset(){return reset()}function wepsim_execute_instruction(){if(check_if_can_execute(true)==false){return false}return execute_microprogram()}function wepsim_execute_microinstruction(){if(check_if_can_execute(true)==false){return false}return execute_microinstruction()}function wepsim_execute_set_breakpoint(a){return asmdbg_set_breakpoint(a)}var DBG_stop=true;function wepsim_execute_stop(a){$(a).html("Run");$(a).removeClass("ui-icon-minus");$(a).addClass("ui-icon-carat-r");$(a).css("backgroundColor","#CCCCCC");DBG_stop=true}function wepsim_execute_play(a){if(check_if_can_execute(true)==false){return false}$(a).css("backgroundColor","rgb(51, 136, 204)");$(a).html("Stop");$(a).removeClass("ui-icon-carat-r");$(a).addClass("ui-icon-minus");DBG_stop=false;wepsim_execute_chainplay(a)}function wepsim_execute_chainplay(e){if(DBG_stop){wepsim_execute_stop(e);return}var a=false;if(get_cfg("DBG_level")=="instruction"){a=execute_microprogram()}else{a=execute_microinstruction()}if(a===false){wepsim_execute_stop(e);return}reg_pc=get_value(sim_states.REG_PC);curr_addr="0x"+reg_pc.toString(16);if((typeof FIRMWARE.assembly[curr_addr]!="undefined")&&(FIRMWARE.assembly[curr_addr].breakpoint)){wepsim_execute_stop(e);alert("Breakpoint @ "+curr_addr+":\nInstruction at "+curr_addr+" is going to be fetched.");return}if((typeof FIRMWARE.comments!="undefined")&&(typeof FIRMWARE.comments[curr_addr]!="undefined")){var f=FIRMWARE.comments[curr_addr];var c=f.split(":");if(c[0].trim().toLowerCase()=="notify"){var d=c.slice(1,b.length).join(":");var a=confirm("Notify @ "+curr_addr+":\n"+d);if(a==true){wepsim_execute_stop(e);return}}}setTimeout(wepsim_execute_chainplay,get_cfg("DBG_delay"),e)}function wepsim_execute_toggle_play(a){if(DBG_stop==false){DBG_stop=true}else{DBG_stop=false;wepsim_execute_play(a)}}function compileAssembly(c,d){var a=get_simware();if(a.firmware.length==0){if(d){alert("WARNING: please load the microcode first.");$.mobile.pageContainer.pagecontainer("change","#main3")}return false}var e=simlang_compile(c,a);if(e.error!=null){if(d){showError(e.error,"inputasm")}return false}if(d){$.notify({title:"<strong>INFO</strong>",message:"Assembly was compiled and loaded."},{type:"success",newest_on_top:true,delay:get_cfg("NOTIF_delay"),placement:{from:"top",align:"center"}})}set_simware(e);update_memories(a);if(d){$("#asm_debugger").html(assembly2html(e.mp,e.labels2,e.seg,e.assembly));showhideAsmElements()}reset();return true}function showBinaryCode(c,a){$(a).html("<center><br>Loading binary, please wait...<br><br>WARNING: loading binary might take time on slow mobile devices.</center>");$(a).css({width:"100%",height:"inherit !important"});$(c).popup("open");setTimeout(function(){var d=get_simware();$(a).html(mp2html(d.mp,d.labels2,d.seg));$(c).popup("reposition",{positionTo:"window"});for(skey in d.seg){$("#compile_begin_"+skey).html("0x"+d.seg[skey].begin.toString(16));$("#compile_end_"+skey).html("0x"+d.seg[skey].end.toString(16))}},300)}function compileFirmware(d,a){var c=load_firmware(d);if(c.error!=null){if(a){showError(c.error,"inputfirm")}return false}if(a){$.notify({title:"<strong>INFO</strong>",message:"Microcode was compiled and loaded."},{type:"success",newest_on_top:true,delay:get_cfg("NOTIF_delay"),placement:{from:"top",align:"center"}})}reset();return true}function showBinaryMicrocode(c,a){$(a).html("<center><br>Loading binary, please wait...<br><br>WARNING: loading binary might take time on slow mobile devices.</center>");$(a).css({width:"100%",height:"inherit !important"});$(c).popup("open");setTimeout(function(){var d=get_simware();$(a).html(firmware2html(d.firmware,true));$(a).css({width:"inherit !important",height:"inherit !important"});$(c).enhanceWithin();$(c).trigger("updatelayout");$(c).popup("reposition",{positionTo:"window"});$(c).trigger("refresh")},300)}function showError(d,c){var e=d.replace(/\t/g," ").replace(/   /g," ");var f=e.match(/Problem around line \d+/);var a="";if(null!=f){f=parseInt(f[0].match(/\d+/)[0]);a+='<button type="button" class="btn btn-danger"         onclick="$.notifyClose();                      var marked = '+c+".addLineClass("+(f-1)+", 'background', 'CodeMirror-selected');                 setTimeout(function() { "+c+".removeLineClass(marked, 'background', 'CodeMirror-selected'); }, 3000);		     var t = "+c+".charCoords({line: "+f+", ch: 0}, 'local').top;		     var middleHeight = "+c+".getScrollerElement().offsetHeight / 2;		     "+c+'.scrollTo(null, t - middleHeight - 5);">Go line '+f+"</button>&nbsp;"}$.notify({title:"<strong>ERROR</strong>",message:e+"<br><center>"+a+'<button type="button" class="btn btn-danger" onclick="$.notifyClose();">Close</button></center>'},{type:"danger",newest_on_top:true,delay:0,placement:{from:"top",align:"center"}})}function showhideAsmElements(){$("input:checkbox:checked").each(function(){var a="table ."+$(this).attr("name");$(a).show()});$("input:checkbox:not(:checked)").each(function(){var a="table ."+$(this).attr("name");$(a).hide()})}function show_help1(){var a=$("#help1_ref").data("relative");if(a==""){return}$("#iframe_help1").load("help/simulator-"+get_cfg("ws_idiom")+".html "+a,function(){$("#help1").trigger("updatelayout");$("#help1").popup("open")})}function sim_init(){var a=document.getElementById("svg_p").contentDocument;if(a!=null){var d=a.getElementById("text3495");if(d!=null){d.addEventListener("click",function(){$("#tab11").trigger("click")},false)}var d=a.getElementById("text3029");if(d!=null){d.addEventListener("click",function(){$("#tab11").trigger("click")},false)}var d=a.getElementById("text3031");if(d!=null){d.addEventListener("click",function(){$("#tab11").trigger("click")},false)}var d=a.getElementById("text3001");if(d!=null){d.addEventListener("click",function(){$("#tab14").trigger("click")},false)}var d=a.getElementById("text3183");if(d!=null){d.addEventListener("click",function(){$("#tab23").trigger("click")},false)}var d=a.getElementById("text3775");if(d!=null){d.addEventListener("click",function(){$("#tab15").trigger("click")},false)}var d=a.getElementById("text3829");if(d!=null){d.addEventListener("click",function(){$("#tab12").trigger("click")},false)}var d=a.getElementById("text3845");if(d!=null){d.addEventListener("click",function(){$("#tab12").trigger("click")},false)}var d=a.getElementById("text3459-7");if(d!=null){d.addEventListener("click",function(){execute_microinstruction()},false)}}var c=document.getElementById("svg_cu").contentDocument;if(c!=null){var d=c.getElementById("text3010");if(d!=null){d.addEventListener("click",function(){$("#tab16").trigger("click")},false)}var d=c.getElementById("text3346-5");if(d!=null){d.addEventListener("click",function(){$("#tab22").trigger("click")},false)}var d=c.getElementById("text4138");if(d!=null){d.addEventListener("click",function(){execute_microinstruction()},false)}}}function sim_prepare_editor(c){c.setValue("\n\n\n\n\n\n\n\n\n");c.getWrapperElement().style["text-shadow"]="0.0em 0.0em";if(get_cfg("editor_theme")=="blackboard"){c.getWrapperElement().style["font-weight"]="normal";c.setOption("theme","blackboard")}var a=get_cfg("editor_mode");if(a=="vim"){c.setOption("keyMap","vim")}if(a=="emacs"){c.setOption("keyMap","emacs")}if(a=="sublime"){c.setOption("keyMap","sublime")}setTimeout(function(){c.refresh()},100)}function load_from_example_assembly(d,e){$.mobile.pageContainer.pagecontainer("change","#main4");inputasm.setValue("Please wait...");inputasm.refresh();var c="examples/exampleCode"+d+".txt?time=20160730a";var a=function(g){inputasm.setValue(g);inputasm.refresh();var h=false;var f=get_simware();if(f.firmware.length!=0){h=compileAssembly(g,true)}if(true==h){if(true==e){setTimeout(function(){$.mobile.pageContainer.pagecontainer("change","#main1")},50)}show_memories_values()}$.notify({title:"<strong>INFO</strong>",message:"Example ready to be used."},{type:"success",newest_on_top:true,delay:get_cfg("NOTIF_delay"),placement:{from:"top",align:"center"}})};wepsim_load_from_url(c,a)}function load_from_example_firmware(d,e){$.mobile.pageContainer.pagecontainer("change","#main3");inputfirm.setValue("Please wait...");inputfirm.refresh();var c="examples/exampleMicrocode"+d+".txt?time=20160730a";var a=function(f){inputfirm.setValue(f);inputfirm.refresh();var g=compileFirmware(f,true);if(true==g){if(true==e){setTimeout(function(){load_from_example_assembly(d,e)},50)}else{show_memories_values()}}$.notify({title:"<strong>INFO</strong>",message:"Example ready to be used."},{type:"success",newest_on_top:true,delay:get_cfg("NOTIF_delay"),placement:{from:"top",align:"center"}})};wepsim_load_from_url(c,a)};